<!doctype html>
<html dir="rtl" lang="fa">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <style> 
	@font-face {
	   font-family: vazir;
	   src: url(vazir.woff);
	}

	* {
	   font-family: vazir;
	}
    </style>
</head>
<body>
<section class="section">
    <div class="container">
        <h1 class="title is-2">
             جاسوس‌یابی
        </h1>
        <p class="subtitle">
            برنامه‌ای برای پخش کردن نقش‌ها از طریق اینترنت 
        </p>
    </div>
</section>

<section class="section" style="padding-top: 0.5em;">
	<div class="columns">
	  <div id="new_game_div" class="column is-4">
	    <div class="box has-text-centered is-half">
	      <h5 class="title is-5">تعداد بازیکن‌ها</h5>
	      <p><input id="player_input" class="input is-primary" type="number" name="players" min="4" value="4" /></p>
	<p>&nbsp;</p>
	      <input class="button is-success" type="button" value="بازی جدید" onclick="newGame()"/>
	    </div>
	  </div>

	<!-- join game -->
	  <div id="join_game_div" class="column is-4">
	    <div class="box has-text-centered is-half">
	      <h5 class="title is-5">کد بازی برای ملحق شدن:  </h5>
	      <p><input id="code_input" class="input is-primary" name="game_code"/></p>
	<p>&nbsp;</p>
	      <input class="button is-success" type="button" value="بریم" onclick="joinGame()"/>
	    </div>
	  </div>
	</div>
</section>

<section id="info_div" class="section is-hidden" style="padding-top: 0.5em;">
	<div class="columns">
	  <div class="column is-4">
	    <div class="box has-text-centered">
	      <h4 class="title is-4">تعداد بازیکن‌ها</h4>
	      <p id="palyers_count"></p>
	      <p>&nbsp;</p>
	      <h5 class="subtitle is-5">کد بازی برای دوستان:</h5>
	      <p id="join_game_code">&nbsp;</p>
	    </div>
	  </div>

          <div class="column is-5"  id="toss_div" class="is-hidden">
            <div class="box has-text-centered is-half">
              <h4 id="role_label" class="title is-4"> نقش شما </h4>
              <p id="role"> شهروند </p>
	      <p>&nbsp;</p>
              <p id="password_label" class="subtitle is-5"> کلمهٔ رمز:  </p>
              <span id="password_text"> آبنما  </span>
          </div>
       </div>
     </div>
</section>

<footer class="footer">
  <div class="content has-text-right">
    <p>
      M.Rahimy <br/> Check <a href="cv.mrahimy.ir">my CV</a>
      <br/>mail: <a href="mailto:mojtaba.rahimy@chmail.ir">mojtaba.rahimy@chmail.ir</a>
    </p>
  </div>
</footer>


<script>
    function newGame(){
        var player_count = document.getElementById('player_input').value;
        var mygetrequest=new ajaxRequest()
        mygetrequest.onreadystatechange=function(){
            newGameRequest(mygetrequest, player_count);
        }
        var player_count_value=encodeURIComponent(player_count)
        mygetrequest.open("GET", "http://www.cafe4sq.ir/toss_api.php?player_count="+player_count_value, true)
        mygetrequest.send(null)

    }

    function newGameRequest(mygetrequest, player_count){
	if (mygetrequest.readyState==4){
		if (mygetrequest.status==200 || window.location.href.indexOf("http")==-1){
		    document.getElementById("new_game_div").classList.add("is-hidden");
		    document.getElementById("join_game_div").classList.add("is-hidden");

		    var infoDiv = document.getElementById("info_div");
		    infoDiv.classList.remove("is-hidden");

		    var node = document.createTextNode(player_count + ' نفر');
		    var p = document.getElementById("palyers_count").appendChild(node);
		    var btn = document.getElementById("toss_div");
		    btn.classList.remove("is-hidden");
		    console.log(mygetrequest.responseText);
		}else{
		    alert("An error has occured making the request")
		}
		}
    }
    
    function ajaxRequest(){
     var activexmodes=["Msxml2.XMLHTTP", "Microsoft.XMLHTTP"] //activeX versions to check for in IE
     if (window.ActiveXObject){ //Test for support for ActiveXObject in IE first (as XMLHttpRequest in IE7 is broken)
      for (var i=0; i<activexmodes.length; i++){
       try{
        return new ActiveXObject(activexmodes[i])
       }
       catch(e){
        //suppress error
       }
      }
     }
     else if (window.XMLHttpRequest) // if Mozilla, Safari etc
      return new XMLHttpRequest()
     else
      return false
    }


</script>



</body></html>
